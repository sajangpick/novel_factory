=====================================
  Novel Factory 사용설명서
  반자동 소설 집필 시스템
=====================================

■ 목차
  1. 서버 실행 방법
  2. 대시보드 접속
  3. 새 에피소드 쓰기 (14화 예시)
  4. AI 모델별 비용
  5. 환경변수 설정 (Render 배포용)
  6. 주요 파일 위치
  7. 문제 해결


=====================================
1. 서버 실행 방법
=====================================

방법 A) 바탕화면의 쓰기.bat 더블클릭

방법 B) 터미널에서 직접 실행
  cd C:\Users\ASUS\Desktop\novel_factory
  npm run dev

→ 서버가 켜지면 브라우저에서 http://localhost:3000 접속


=====================================
2. 대시보드 접속
=====================================

주소: http://localhost:3000/dashboard
비밀번호: 12345

왼쪽 메뉴 구성:
  - 대시보드 홈      : 전체 현황
  - Step 1~5        : 소설 기획 단계 (이미 완료됨)
  - Step 6: 본문 집필 : ★ 여기서 소설을 씁니다
  - Step 7: 품질 검수 : AI가 쓴 글 검수
  - Step 8: DB 업데이트: Supabase 저장
  - 인명록 관리      : 캐릭터 37명 관리
  - World DB 관리    : 세계관 자료


=====================================
3. 새 에피소드 쓰기 (14화 예시) — AI 작가 파이프라인
=====================================

Step 6: 본문 집필 페이지에서 진행합니다.
상단에 파이프라인 진행 바가 표시됩니다:
  📋 A.설계도 → 🏗️ B.구조 설계 → 📝 C.AI 생성 → 🔍 D.EP 검사 → ✅ 완료

[Step A] 설계도 세팅                          비용: $0
  - "+ 14화 쓰기" 버튼 클릭 (또는 화 번호를 14로 변경)
  - "⚡ 자동 세팅" 버튼 클릭
  - 자동 로딩 내용:
    · 🗺️ 14화 스토리 로드맵 (미래 계획)
    · 📍 현재 상태 (위치, 건강, 무공 등)
    · ⚠️ 14화 주의사항 (캐릭터별)
    · 🎣 활성 떡밥
    · 📖 13화 엔딩 장면 (연결용)
  - 내용 확인/수정 후 "🏗️ 다음: 구조 설계 →" 클릭

[Step B] 구조 설계 (Gemini Flash)             비용: ~$0.01
  - 설계도를 기반으로 자동 생성:
    · 6하원칙 (누가/언제/어디서/무엇을/왜/어떻게)
    · 5막 구조 (도입~마무리, 감정 리듬, 텐션)
    · 핵심 장면 3개 (대사 샘플 포함)
    · 코미디 비트 7개 계획
    · 절단신공 설계
  ★★ 여기서 구조를 확인/수정하세요! ★★
  - "이 장면은 빼자" "4막에 이 대사를 넣자" 등 수정
  - 구조가 좋을수록 최종 소설 품질이 높아집니다
  - 확인 후 "📝 다음: AI 생성 →" 클릭

[Step C] AI 생성                              비용: $0.01~$0.30
  - 하단의 AI 모델 선택:
    · Lv.1 초안 (Gemini Flash) = ~$0.01  ← 기본값
    · Lv.2 다듬기 (Claude Sonnet) = ~$0.30 ← 권장
    · Lv.3 최종 (Claude Opus) = ~$2.00
  - 추천: 구조 설계를 거쳤으므로 Lv.2(Sonnet)가 최적
    (구조 없이 Opus를 쓰는 것보다, 구조 있는 Sonnet이 더 좋음)
  - "AI 생성" 버튼 클릭 → 30초~2분 대기
  - 생성 완료 후 직접 수정 가능

[Step D] EP 규칙 검사 (Gemini Flash)          비용: ~$0.01
  - "🔍 EP 규칙 검사" 버튼 클릭
  - 자동 검사 항목:
    · 금지어 (상태창, 현대어 등)
    · 천마 말투 (반말 위반?)
    · 몸 소유권 (이준혁/천마 물리 행동?)
    · 전투 중 수다
    · 시끄러/나쁘지않 과다
    · 분량 체크
    · 코미디 비트 수
  - 오른쪽에 점수(100점 만점) + 상세 결과 표시
  - 문제 있는 부분만 직접 수정 후 저장

[자동 처리]
  - 생성 완료 시 소설_진행_마스터.md 자동 업데이트
  - 백업 파일 자동 생성
  - 다음 15화 쓸 때 자동 세팅에 14화 내용 반영

★ 총 비용 예상:
  Lv.1 파이프라인: ~$0.03/화 (설계$0 + 구조$0.01 + 생성$0.01 + 검사$0.01)
  Lv.2 파이프라인: ~$0.33/화 (설계$0 + 구조$0.01 + 생성$0.30 + 검사$0.01) ← 추천
  비교: Cursor 대화로 쓸 때 $15~50/화


=====================================
4. AI 모델별 비용
=====================================

┌─────────────┬──────────────┬───────────┬──────────┐
│ 레벨        │ 모델         │ 1화 비용  │ 용도     │
├─────────────┼──────────────┼───────────┼──────────┤
│ Lv.1 초안   │ Gemini Flash │ ~$0.01    │ 초안     │
│ Lv.2 다듬기 │ Claude Sonnet│ ~$0.30    │ 다듬기   │
│ Lv.3 최종   │ Claude Opus  │ ~$2.00    │ 최종본   │
└─────────────┴──────────────┴───────────┴──────────┘

참고: Cursor에서 대화로 쓸 때는 1화에 $10~30+
      이 시스템은 1화에 $0.01~2.00

추천 워크플로우 (AI 작가 파이프라인):
  1. 자동 세팅 → 구조 설계 → 확인/수정 (여기가 핵심!)
  2. Lv.2(Sonnet)로 생성 ($0.30) — 구조가 있으면 Sonnet이 최적
  3. EP 검사로 문제 확인 ($0.01)
  4. 문제 있으면 직접 수정 후 저장
  → 1화당 총 ~$0.33, 품질 85~90점


=====================================
5. 환경변수 설정 (Render 배포용)
=====================================

Render 대시보드 > Environment 에 아래 6개 추가:

  NEXT_PUBLIC_SUPABASE_URL    = https://yzhpqnpkhhxvptogybam.supabase.co
  NEXT_PUBLIC_SUPABASE_ANON_KEY = (env.local 파일의 긴 키)
  GEMINI_API_KEY              = (env.local 파일의 Gemini 키)
  CLAUDE_API_KEY              = (env.local 파일의 Claude 키)
  NEXT_PUBLIC_PASSWORD        = 12345
  SERIES_ID                   = a0eebc99-9c0b-4ef8-bb6d-6bb9bd380a11

Render 빌드 설정:
  Build Command: npm install && npm run build
  Start Command: npm start


=====================================
6. 주요 파일 위치
=====================================

소설 원고:
  novels/murim_mna/output/제1화.md ~ 제13화.md

참조 자료:
  novels/murim_mna/소설_진행_마스터.md   ← 현재 상태 + 다음 화 주의사항
  novels/murim_mna/master_story_bible.md ← 300화 전체 로드맵
  novels/murim_mna/캐릭터_인명록.md      ← 캐릭터 상세 정보
  novels/murim_mna/집필_규칙.md          ← EP규칙, 3인격 엔진

세계관 DB:
  novels/murim_mna/world_db/            ← 무공, 음식, 지리, 의복 등

대시보드 코드:
  app/dashboard/step6/page.tsx           ← 본문 집필 페이지 (파이프라인 UI)
  app/api/generate-episode/route.ts      ← AI 소설 생성 엔진
  app/api/auto-blueprint/route.ts        ← 설계도 자동 세팅
  app/api/structure-design/route.ts      ← ★ 구조 설계 (6하원칙+5막+핵심장면)
  app/api/ep-check/route.ts             ← ★ EP 규칙 검사
  app/api/update-master/route.ts         ← 마스터 자동 업데이트

환경변수:
  .env.local                             ← API 키 (Git에 안 올라감)


=====================================
7. 문제 해결
=====================================

Q: 서버가 안 켜져요
A: 터미널에서 cd C:\Users\ASUS\Desktop\novel_factory 후 npm run dev

Q: 설계도 자동 세팅이 안 돼요
A: 서버가 켜져 있는지 확인. 브라우저 새로고침(F5) 후 다시 시도

Q: AI 생성 버튼을 눌렀는데 에러가 나요
A: .env.local 파일에 GEMINI_API_KEY가 있는지 확인
   설계도가 100자 이상인지 확인

Q: 캐릭터가 안 보여요
A: 대시보드 > 인명록 관리에서 37명이 보이는지 확인

Q: 소설_진행_마스터가 이상해졌어요
A: novels/murim_mna/ 폴더에 백업 파일이 있습니다
   소설_진행_마스터_backup_N화전.md 파일을 복사해서 복원

Q: Render 배포 후 설계도 자동 세팅이 안 돼요
A: Render에서는 로컬 파일 읽기가 제한될 수 있습니다
   로컬 서버(localhost:3000)에서 사용하는 것을 권장합니다

Q: 비용이 너무 많이 나가요
A: AI 모델을 Lv.1 (Gemini Flash)로 설정했는지 확인
   Lv.1은 1화에 $0.01 수준입니다


=====================================
  GitHub: https://github.com/sajangpick/novel_factory
  최종 업데이트: 2026-02-16
  업데이트 내용: AI 작가 파이프라인 (구조설계+EP검사) 추가
=====================================
